---
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";
import { navLinks } from "@/data/navLinks";
import NavLink from "./NavLink.astro";
import ThemeButton from "./ThemeButton.svelte";
import avatarImage from "@/assets/img/avatar.jpg";
import Link from "./Link.astro";
import { cx } from "@/lib/cx";
---

<header
	class={cx([
		"sticky top-0 left-0 my-4 z-100",
		"leading-header bg-bg w-full overflow-hidden select-none",
		"max-h-header h-dvh",
		"transition-[max-height] not-motion-reduce:duration-300",
		"md:flex md:justify-between",
		"has-checked:max-h-dvh"
	])}
>
	<nav class="max-md:self-start">
		<Link
			class={cx([
				"inline-flex h-full items-center justify-start px-4 sm:px-8",
				"not-last:border-r-border border-r-0 not-last:border-r md:border-b-0",
				"font-bold text-nowrap no-underline",
				"group"
			])}
			href="/"
			title="Home"
		>
			<Image
				class="max-h-header max-xs:hidden mr-2 aspect-square h-full w-auto rounded-full object-contain p-1 sm:mr-4 md:my-2"
				src={avatarImage}
				alt=""
			/>
			<span class="group-hover:text-primary">bo lingen</span>
		</Link>
	</nav>

	<nav class="group/nav flex flex-row items-center">
		<menu
			class="flex flex-col items-center max-md:order-last max-md:w-full md:flex-row"
		>
			{navLinks.map((link) => <NavLink class="max-md:w-dvw" {...link} />)}
		</menu>

		<menu
			class="group/navicons absolute top-0 right-4 flex flex-row items-center gap-0 sm:gap-2 md:static md:ml-2"
		>
			<ThemeButton
				client:only="svelte"
				class="aspect-square size-5 max-md:w-full md:mx-4 md:mb-1"
				iconSize="1.25rem"
			>
				<!-- this fallback "works", but doesn't get removed after hydration -->
				<!-- https://github.com/withastro/astro/issues/12513 -->
				<!-- currently using styling to hide it when the button is present -->
				<!-- tabler:sun-moon -->
				<svg
					slot="fallback"
					class="mb-1 aspect-square size-5 cursor-wait text-gray-500 group-has-[button]/navicons:hidden max-md:w-full md:mx-4"
					xmlns="http://www.w3.org/2000/svg"
					width="1.25rem"
					height="1.25rem"
					viewBox="0 0 24 24"
				>
					<g
						fill="none"
						stroke="currentColor"
						stroke-linecap="round"
						stroke-linejoin="round"
						stroke-width="2"
					>
						<path d="M9.173 14.83a4 4 0 1 1 5.657-5.657"></path>
						<path
							d="m11.294 12.707l.174.247a7.5 7.5 0 0 0 8.845 2.492A9 9 0 0 1 5.642 18.36M3 12h1m8-9v1M5.6 5.6l.7.7M3 21L21 3"
						>
						</path>
					</g>
				</svg>
			</ThemeButton>

			<input type="checkbox" class="hidden!" id="nav-toggle" />

			<label
				for="nav-toggle"
				class="h-header hover:text-primary flex cursor-pointer flex-col justify-center px-3 md:hidden"
			>
				<Icon name="tabler:menu-2" />
			</label>
		</menu>
	</nav>
</header>
